{"version":3,"file":"content-script.js","sources":["../extension/content-script.ts"],"sourcesContent":["// Content script that runs on claude.ai pages\n// Injects the fetch interceptor and observes DOM for activities\n\nimport type { CapturedResponse, DOMActivity, ExtensionMessage } from './types';\n\n// Inject the fetch interceptor script into page context\nfunction injectScript(): void {\n  const script = document.createElement('script');\n  script.src = chrome.runtime.getURL('injected.js');\n  (document.head || document.documentElement).appendChild(script);\n  script.onload = () => script.remove();\n}\n\n// Listen for captured responses from injected script\nfunction setupResponseListener(): void {\n  window.addEventListener('claude-utils-response', ((event: CustomEvent<CapturedResponse>) => {\n    console.log('[Claude Utils] Content script received response:', event.detail);\n    sendToBackground({ type: 'CLAUDE_RESPONSE', data: event.detail });\n  }) as EventListener);\n}\n\n// Observe DOM for artifacts, code blocks, and tool usage\nfunction setupDOMObserver(): void {\n  const observer = new MutationObserver((mutations) => {\n    for (const mutation of mutations) {\n      for (const node of mutation.addedNodes) {\n        if (node instanceof HTMLElement) {\n          detectActivities(node);\n        }\n      }\n    }\n  });\n\n  // Start observing when document is ready\n  if (document.body) {\n    observer.observe(document.body, { childList: true, subtree: true });\n  } else {\n    document.addEventListener('DOMContentLoaded', () => {\n      observer.observe(document.body, { childList: true, subtree: true });\n    });\n  }\n}\n\nfunction detectActivities(element: HTMLElement): void {\n  // Detect artifacts (usually have data-artifact-* attributes or specific class names)\n  const artifacts = element.querySelectorAll('[data-artifact-id], .artifact-container');\n  for (const artifact of artifacts) {\n    const title = artifact.getAttribute('data-artifact-title') ??\n      artifact.querySelector('[class*=\"title\"]')?.textContent ?? 'Untitled';\n    const type = artifact.getAttribute('data-artifact-type') ?? 'unknown';\n\n    sendDOMActivity({\n      type: 'artifact',\n      title,\n      artifactType: type,\n      timestamp: Date.now(),\n    });\n  }\n\n  // Detect code blocks\n  const codeBlocks = element.querySelectorAll('pre code, .code-block');\n  for (const codeBlock of codeBlocks) {\n    // Try to get language from class name (e.g., language-typescript)\n    const classList = codeBlock.className;\n    const langMatch = classList.match(/language-(\\w+)/);\n    const language = langMatch?.[1] ?? 'unknown';\n    const codeContent = codeBlock.textContent ?? '';\n\n    sendDOMActivity({\n      type: 'code_block',\n      language,\n      codeContent,\n      timestamp: Date.now(),\n    });\n  }\n\n  // Detect tool usage (look for tool-related elements)\n  const toolElements = element.querySelectorAll('[data-tool-name], .tool-use, .tool-result');\n  for (const toolEl of toolElements) {\n    const toolName = toolEl.getAttribute('data-tool-name') ??\n      toolEl.querySelector('[class*=\"tool-name\"]')?.textContent ?? 'unknown';\n    const isResult = toolEl.classList.contains('tool-result') ||\n      toolEl.getAttribute('data-tool-result') !== null;\n\n    sendDOMActivity({\n      type: isResult ? 'tool_result' : 'tool_use',\n      toolName,\n      timestamp: Date.now(),\n    });\n  }\n}\n\nfunction sendDOMActivity(activity: DOMActivity): void {\n  sendToBackground({ type: 'DOM_ACTIVITY', data: activity });\n}\n\n// Track conversation title changes\nfunction setupTitleObserver(): void {\n  let lastTitle = '';\n\n  const checkTitle = () => {\n    // Try to get conversation title from page\n    const titleEl = document.querySelector('h1, [data-conversation-title]');\n    const title = titleEl?.textContent?.trim() ?? '';\n\n    if (title && title !== lastTitle) {\n      lastTitle = title;\n\n      // Get conversation ID from URL\n      const match = window.location.pathname.match(/\\/chat\\/([^/?]+)/);\n      const conversationId = match?.[1];\n\n      if (conversationId) {\n        sendToBackground({\n          type: 'CONVERSATION_TITLE',\n          data: { title, conversationId },\n        });\n      }\n    }\n  };\n\n  // Check periodically and on navigation\n  setInterval(checkTitle, 2000);\n  window.addEventListener('popstate', checkTitle);\n}\n\nfunction sendToBackground(message: ExtensionMessage): void {\n  chrome.runtime.sendMessage(message).catch(() => {\n    // Silently ignore if background is not ready\n  });\n}\n\n// Initialize\ninjectScript();\nsetupResponseListener();\nsetupDOMObserver();\nsetupTitleObserver();\n\nconsole.log('[Claude Utils] Content script loaded');\n"],"names":[],"mappings":"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"}